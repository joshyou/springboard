--Search hypotheses:
--people use search to find the people and groups they are interested in. search is a common function in yammer
--most of the time, users type something into the search bar and click on an auto-complete option
--most of the time, users who actually run a search will select an option from the top 10

SELECT count(user_id) FROM tutorial.yammer_events 
WHERE occurred_at >= '2014-08-01 00:00:00'
--79089 total events occurred in August 2014

SELECT count(user_id), event_name FROM tutorial.yammer_events 
WHERE occurred_at >= '2014-08-01 00:00:00' 
GROUP BY event_name
ORDER BY event_name
--4469 autocompletes ran
--2836 searches ran
--number of autocomplete + search run is about 78% the number of logins
--earlier search results are clicked more often, but the ratio is not super high- 274 clicks for 1st result, 103 for last result

SELECT count(user_id)
FROM tutorial.yammer_events 
WHERE occurred_at >= '2014-08-01 00:00:00' AND event_name like '%search_click_result%'
--1947, which is 68% of search runs
--number of top 10 clicks is 68% of the number of search runs

SELECT count(distinct user_id), event_name 
FROM tutorial.yammer_events 
WHERE occurred_at >= '2014-08-01 00:00:00' 
GROUP BY event_name
--2795 distinct users logged in this month, 1509 distinct users used search_autocomplete, and 609 used search_run
--approximately 700 users logged in but never searched this month

SELECT count(user_id)
FROM tutorial.yammer_events
WHERE occurred_at >= '2014-08-01 00:00:00' 
AND user_id in (SELECT distinct user_id FROM tutorial.yammer_events
WHERE occurred_at >= '2014-08-01 00:00:00' 
AND event_name like '%search%')
AND event_name = 'login'
--users who performed at least one search this month logged in 7047 times

SELECT count(user_id)
FROM tutorial.yammer_events 
WHERE occurred_at >= '2014-08-01 00:00:00' 
AND event_name like '%search%'
--these users performed 9252 search actions

--Conclusions:

--Most users use one of the search functions at least occasionally, so the search function works and is at least
--somewhat useful.
--Autocomplete is more popular than running a search, suggesting that users usually find what they need from
--the autocomplete dropdown.
--Users usually click on one of the top 10 options after running a search, but not always. This suggests
--that search runs are not selecting the 10 options as well as they could be.
--The earlier results in the top 10 are clicked on more often, but not overwhelmingly so. This suggests
--that the ranking of the top 10 results could be improved.
